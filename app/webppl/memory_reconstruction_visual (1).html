<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø§ÙƒÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª - CPF Lite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200;400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        
        .memory-scene {
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .memory-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            transition: all 0.6s ease;
        }
        
        .emotion-particle {
            position: absolute;
            width: 4px; height: 4px;
            border-radius: 50%;
            animation: float 3s infinite ease-in-out;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); opacity: 0.7; }
            50% { transform: translateY(-20px); opacity: 1; }
        }
        
        .memory-element {
            transition: all 0.6s ease;
            transform-origin: center;
        }
        
        .reconstruction-wave {
            position: absolute;
            border: 2px solid;
            border-radius: 50%;
            animation: wave-expand 2s infinite linear;
        }
        
        @keyframes wave-expand {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .mood-filter {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            mix-blend-mode: overlay;
            transition: all 0.8s ease;
        }
        
        .glitch {
            animation: glitch 0.3s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }
        
        .detail-highlight {
            animation: highlight-pulse 2s infinite ease-in-out;
        }
        
        @keyframes highlight-pulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.3); }
        }
        
        .fade-memory {
            animation: fade-in-out 4s ease-in-out;
        }
        
        @keyframes fade-in-out {
            0% { opacity: 0; transform: scale(0.8); }
            20% { opacity: 1; transform: scale(1); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0.7; transform: scale(0.95); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-800 to-pink-700 min-h-screen text-white overflow-x-hidden">
    
    <div x-data="memoryReconstructionCPF()" class="container mx-auto px-4 py-6">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-yellow-300 via-pink-300 to-blue-300 bg-clip-text text-transparent">
                ğŸ§  Ù…Ø­Ø§ÙƒÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª
            </h1>
            <p class="text-lg text-purple-200">CPF~ Lite - Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙƒØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©</p>
            <div class="text-sm text-purple-300 mt-2">
                <i class="fas fa-lightbulb mr-2"></i>
                Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ù„ÙŠØ³Øª Ù…Ù„ÙØ§Øª Ù…Ø­ÙÙˆØ¸Ø©ØŒ Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ ØªØªØ£Ø«Ø± Ø¨Ù…Ø²Ø§Ø¬Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ
            </div>
        </header>

        <!-- Memory Selection & Controls -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
            
            <!-- Memory Selection -->
            <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <h3 class="text-lg font-bold mb-3 text-center">ğŸ“š Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒØ±Ù‰</h3>
                
                <select x-model="selectedMemoryId" @change="loadMemory()" 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white">
                    <template x-for="memory in availableMemories" :key="memory.id">
                        <option :value="memory.id" x-text="memory.title"></option>
                    </template>
                </select>
                
                <div class="mt-3 text-sm text-purple-200" x-show="selectedMemory">
                    <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> <span x-text="selectedMemory?.type"></span></p>
                    <p><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> <span x-text="selectedMemory?.age"></span></p>
                    <p><strong>Ø§Ù„Ø£Ù‡Ù…ÙŠØ©:</strong> <span x-text="selectedMemory?.importance"></span></p>
                </div>
            </div>

            <!-- Current Mood Controls -->
            <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <h3 class="text-lg font-bold mb-3 text-center">ğŸ­ Ø§Ù„Ù…Ø²Ø§Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                
                <!-- Joy -->
                <div class="mb-2">
                    <label class="text-sm font-semibold block mb-1">ğŸ˜Š Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</label>
                    <input type="range" min="0" max="1" step="0.1" x-model="currentMood.joy" 
                           @input="updateEmotionalFilter()"
                           class="w-full h-2 bg-gradient-to-r from-gray-300 to-yellow-400 rounded-lg appearance-none cursor-pointer">
                    <div class="text-center text-xs mt-1" x-text="`${(currentMood.joy * 100).toFixed(0)}%`"></div>
                </div>
                
                <!-- Sadness -->
                <div class="mb-2">
                    <label class="text-sm font-semibold block mb-1">ğŸ˜¢ Ø§Ù„Ø­Ø²Ù†</label>
                    <input type="range" min="0" max="1" step="0.1" x-model="currentMood.sadness" 
                           @input="updateEmotionalFilter()"
                           class="w-full h-2 bg-gradient-to-r from-gray-300 to-blue-500 rounded-lg appearance-none cursor-pointer">
                    <div class="text-center text-xs mt-1" x-text="`${(currentMood.sadness * 100).toFixed(0)}%`"></div>
                </div>
                
                <!-- Anxiety -->
                <div class="mb-2">
                    <label class="text-sm font-semibold block mb-1">ğŸ˜° Ø§Ù„Ù‚Ù„Ù‚</label>
                    <input type="range" min="0" max="1" step="0.1" x-model="currentMood.anxiety" 
                           @input="updateEmotionalFilter()"
                           class="w-full h-2 bg-gradient-to-r from-gray-300 to-red-500 rounded-lg appearance-none cursor-pointer">
                    <div class="text-center text-xs mt-1" x-text="`${(currentMood.anxiety * 100).toFixed(0)}%`"></div>
                </div>
                
                <!-- Nostalgia -->
                <div class="mb-2">
                    <label class="text-sm font-semibold block mb-1">ğŸŒ… Ø§Ù„Ø­Ù†ÙŠÙ†</label>
                    <input type="range" min="0" max="1" step="0.1" x-model="currentMood.nostalgia" 
                           @input="updateEmotionalFilter()"
                           class="w-full h-2 bg-gradient-to-r from-gray-300 to-purple-400 rounded-lg appearance-none cursor-pointer">
                    <div class="text-center text-xs mt-1" x-text="`${(currentMood.nostalgia * 100).toFixed(0)}%`"></div>
                </div>
            </div>

            <!-- Reconstruction Metrics -->
            <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <h3 class="text-lg font-bold mb-3 text-center">ğŸ“Š Ù…Ù‚Ø§ÙŠÙŠØ³ Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡</h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-sm">Ø«Ù‚Ø© Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡:</span>
                        <span class="text-sm font-bold" x-text="`${(reconstructionMetrics.confidence * 100).toFixed(1)}%`"></span>
                    </div>
                    <div class="w-full bg-gray-300 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-500"
                             :class="reconstructionMetrics.confidence > 0.7 ? 'bg-green-400' : reconstructionMetrics.confidence > 0.4 ? 'bg-yellow-400' : 'bg-red-400'"
                             :style="`width: ${reconstructionMetrics.confidence * 100}%`"></div>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-sm">Ø§Ù„ØªØ´ÙˆÙŠÙ‡ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</span>
                        <span class="text-sm font-bold" x-text="`${(reconstructionMetrics.distortion * 100).toFixed(1)}%`"></span>
                    </div>
                    <div class="w-full bg-gray-300 rounded-full h-2">
                        <div class="h-2 rounded-full transition-all duration-500"
                             :class="reconstructionMetrics.distortion > 0.6 ? 'bg-red-400' : reconstructionMetrics.distortion > 0.3 ? 'bg-yellow-400' : 'bg-green-400'"
                             :style="`width: ${reconstructionMetrics.distortion * 100}%`"></div>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-sm">ØªÙ†ÙˆØ¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„:</span>
                        <span class="text-sm font-bold" x-text="`${(reconstructionMetrics.variation * 100).toFixed(1)}%`"></span>
                    </div>
                    <div class="w-full bg-gray-300 rounded-full h-2">
                        <div class="bg-purple-400 h-2 rounded-full transition-all duration-500"
                             :style="`width: ${reconstructionMetrics.variation * 100}%`"></div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                <h3 class="text-lg font-bold mb-3 text-center">âš¡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
                
                <button @click="reconstructMemory()" 
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-4 py-2 rounded-lg font-bold mb-3 transition-all duration-300 hover:scale-105">
                    <i class="fas fa-brain mr-2"></i>
                    Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø°ÙƒØ±Ù‰
                </button>
                
                <button @click="compareReconstructions()" 
                        class="w-full bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 px-4 py-2 rounded-lg font-bold mb-3 transition-all duration-300 hover:scale-105">
                    <i class="fas fa-compare mr-2"></i>
                    Ù…Ù‚Ø§Ø±Ù†Ø© Ø¥Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
                </button>
                
                <button @click="randomizeMood()" 
                        class="w-full bg-gradient-to-r from-pink-600 to-red-600 hover:from-pink-700 hover:to-red-700 px-4 py-2 rounded-lg font-bold transition-all duration-300 hover:scale-105">
                    <i class="fas fa-random mr-2"></i>
                    Ù…Ø²Ø§Ø¬ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                </button>
            </div>
        </div>

        <!-- Main Memory Visualization -->
        <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 mb-6 border border-white/20">
            <h3 class="text-xl font-bold mb-4 text-center">ğŸ¨ Ù…Ø´Ù‡Ø¯ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ù…ÙØ¹Ø§Ø¯ Ø¨Ù†Ø§Ø¤Ù‡Ø§</h3>
            
            <div class="memory-scene relative h-96 rounded-lg overflow-hidden" 
                 :style="memoryVisualization.sceneStyle">
                
                <!-- Mood Filter Overlay -->
                <div class="mood-filter" :style="memoryVisualization.moodFilter"></div>
                
                <!-- Memory Elements -->
                <template x-for="element in memoryVisualization.elements" :key="element.id">
                    <div class="memory-element absolute" 
                         :style="element.style"
                         :class="element.classes">
                        <div x-text="element.content" class="text-center"></div>
                        
                        <!-- Emotion Particles -->
                        <template x-for="particle in element.particles" :key="particle.id">
                            <div class="emotion-particle" 
                                 :style="particle.style"></div>
                        </template>
                    </div>
                </template>
                
                <!-- Reconstruction Waves -->
                <template x-for="wave in reconstructionWaves" :key="wave.id">
                    <div class="reconstruction-wave" 
                         :style="wave.style"></div>
                </template>
                
                <!-- Memory Text Overlay -->
                <div class="absolute bottom-4 left-4 right-4 bg-black/40 rounded-lg p-4">
                    <h4 class="font-bold text-lg mb-2">ğŸ“ Ø§Ù„Ø³Ø±Ø¯ Ø§Ù„Ù…ÙØ¹Ø§Ø¯ Ø¨Ù†Ø§Ø¤Ù‡:</h4>
                    <p class="text-white/90 leading-relaxed" x-text="reconstructedNarrative"></p>
                </div>
            </div>
        </div>

        <!-- Comparison Grid -->
        <div x-show="comparisonMode" class="mb-6">
            <h3 class="text-xl font-bold mb-4 text-center">ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø¥Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <template x-for="(comparison, index) in reconstructionComparisons" :key="index">
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
                        <h4 class="font-bold text-center mb-2" x-text="comparison.moodLabel"></h4>
                        
                        <!-- Mini visualization -->
                        <div class="h-32 rounded-lg mb-3 relative overflow-hidden" 
                             :style="comparison.miniScene">
                            <div class="mood-filter" :style="comparison.moodFilter"></div>
                            <div class="absolute inset-4 flex items-center justify-center text-center">
                                <span x-text="comparison.dominantEmotion" class="text-2xl"></span>
                            </div>
                        </div>
                        
                        <!-- Key differences -->
                        <div class="text-sm space-y-1">
                            <div><strong>Ø§Ù„ØªØ±ÙƒÙŠØ²:</strong> <span x-text="comparison.focus"></span></div>
                            <div><strong>Ø§Ù„Ø·Ø§Ø¨Ø¹:</strong> <span x-text="comparison.tone"></span></div>
                            <div><strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong> <span x-text="comparison.details"></span></div>
                        </div>
                        
                        <!-- Metrics -->
                        <div class="mt-3 space-y-1">
                            <div class="flex justify-between text-xs">
                                <span>Ø§Ù„Ø«Ù‚Ø©:</span>
                                <span x-text="`${(comparison.confidence * 100).toFixed(0)}%`"></span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span>Ø§Ù„ØªØ´ÙˆÙŠÙ‡:</span>
                                <span x-text="`${(comparison.distortion * 100).toFixed(0)}%`"></span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Technical Details -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- WebPPL Console -->
            <div class="bg-black/20 backdrop-blur-md rounded-xl p-6 border border-white/20">
                <h3 class="text-xl font-bold mb-4 text-center">ğŸ’» WebPPL Engine</h3>
                <div id="webpplConsole" class="bg-black/40 rounded-lg p-4 font-mono text-sm text-green-300 h-48 overflow-y-auto">
                    <div>CPF~ Lite Memory Reconstruction Engine</div>
                    <div>Agate Memory: Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª ÙƒØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©</div>
                    <div>WebPPL: Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ©</div>
                </div>
            </div>

            <!-- Memory Analysis -->
            <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20">
                <h3 class="text-xl font-bold mb-4 text-center">ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±Ù‰</h3>
                
                <div class="space-y-4">
                    <!-- Original vs Reconstructed -->
                    <div>
                        <h4 class="font-bold mb-2">ğŸ”„ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…ÙØ¹Ø§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡:</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white/5 rounded p-2">
                                <div class="font-semibold">Ø§Ù„Ø°ÙƒØ±Ù‰ Ø§Ù„Ø£ØµÙ„ÙŠØ©:</div>
                                <div x-text="originalMemoryTone" class="text-gray-300"></div>
                            </div>
                            <div class="bg-white/5 rounded p-2">
                                <div class="font-semibold">Ø§Ù„Ù…ÙØ¹Ø§Ø¯ Ø¨Ù†Ø§Ø¤Ù‡Ø§:</div>
                                <div x-text="reconstructedMemoryTone" class="text-gray-300"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Emotional Encryption Analysis -->
                    <div>
                        <h4 class="font-bold mb-2">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ´ÙÙŠØ± Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</h4>
                        <div class="text-sm space-y-1">
                            <div class="flex justify-between">
                                <span>Ù‚ÙˆØ© Ø§Ù„ØªØ´ÙÙŠØ±:</span>
                                <span x-text="`${(emotionalEncryption.strength * 100).toFixed(0)}%`"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</span>
                                <span x-text="`${(emotionalEncryption.keyMatch * 100).toFixed(0)}%`"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆØµÙˆÙ„:</span>
                                <span x-text="emotionalEncryption.accessLevel"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reconstruction Quality -->
                    <div>
                        <h4 class="font-bold mb-2">â­ Ø¬ÙˆØ¯Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡:</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span>Ø§Ù„Ø§ØªØ³Ø§Ù‚ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ:</span>
                                <span x-text="`${(qualityMetrics.logicalConsistency * 100).toFixed(0)}%`"></span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-1">
                                <div class="bg-blue-400 h-1 rounded-full transition-all duration-500"
                                     :style="`width: ${qualityMetrics.logicalConsistency * 100}%`"></div>
                            </div>
                            
                            <div class="flex justify-between text-sm">
                                <span>Ø§Ù„Ø£ØµØ§Ù„Ø© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ©:</span>
                                <span x-text="`${(qualityMetrics.emotionalAuthenticity * 100).toFixed(0)}%`"></span>
                            </div>
                            <div class="w-full bg-gray-300 rounded-full h-1">
                                <div class="bg-pink-400 h-1 rounded-full transition-all duration-500"
                                     :style="`width: ${qualityMetrics.emotionalAuthenticity * 100}%`"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Warning & Credits Footer -->
        <div class="mt-8 space-y-4">
            <!-- Academic Warning -->
            <div class="bg-amber-900/30 border border-amber-500 rounded-xl p-6 backdrop-blur-md">
                <div class="flex items-start space-x-3 space-x-reverse">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-amber-400 text-2xl"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-amber-200 mb-2">âš ï¸ ØªØ­Ø°ÙŠØ± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ù…Ù‡Ù…</h3>
                        <div class="text-amber-100 space-y-2 text-sm leading-relaxed">
                            <p><strong>Ù‡Ø°Ø§ Ù…Ø­Ø§ÙƒÙŠ Ù†Ø¸Ø±ÙŠ Ù„Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ÙŠ Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«ÙŠØ© ÙÙ‚Ø·.</strong></p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                                <div>
                                    <p class="font-semibold text-amber-200 mb-1">âœ… Ù…ÙØµÙ…Ù… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ:</p>
                                    <ul class="list-disc list-inside space-y-1 text-xs">
                                        <li>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ</li>
                                        <li>Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</li>
                                        <li>ÙÙ‡Ù… Ø¢Ù„ÙŠØ§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ù†Ø¸Ø±ÙŠØ§Ù‹</li>
                                        <li>ØªØ·ÙˆÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¹Ø±ÙÙŠ</li>
                                    </ul>
                                </div>
                                <div>
                                    <p class="font-semibold text-amber-200 mb-1">âŒ ØºÙŠØ± Ù…ÙØµÙ…Ù… Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ:</p>
                                    <ul class="list-disc list-inside space-y-1 text-xs">
                                        <li>Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø·Ø¨ÙŠ Ø£Ùˆ Ø§Ù„Ù†ÙØ³ÙŠ</li>
                                        <li>Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù†ÙØ³ÙŠ Ø£Ùˆ Ø§Ù„ØªØ¯Ø®Ù„ Ø§Ù„Ø¥ÙƒÙ„ÙŠÙ†ÙŠÙƒÙŠ</li>
                                        <li>Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ù‡Ù…Ø©</li>
                                        <li>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© Ø§Ù„ÙØ¹Ù„ÙŠØ©</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-amber-800/20 rounded-lg border border-amber-600/30">
                                <p class="text-xs font-medium">
                                    <i class="fas fa-stethoscope mr-2"></i>
                                    Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ­ØªØ§Ø¬ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù†ÙØ³ÙŠØ© Ø£Ùˆ Ø·Ø¨ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ø¤Ù‡Ù„.
                                    Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø§Ø³ÙˆØ¨ÙŠØ© ÙˆÙ„ÙŠØ³ Ø¨Ø¯ÙŠÙ„Ø§Ù‹ Ù„Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Credits & Contributors -->
            <div class="bg-gradient-to-r from-purple-900/40 to-blue-900/40 border border-purple-500/30 rounded-xl p-4 backdrop-blur-md">
                <div class="text-center">
                    <h3 class="text-lg font-bold text-purple-200 mb-2">ğŸ‘¨â€ğŸ’» ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹</h3>
                    <div class="flex flex-col md:flex-row items-center justify-center space-y-2 md:space-y-0 md:space-x-6 md:space-x-reverse">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <i class="fas fa-brain text-purple-400"></i>
                            <span class="text-purple-200 font-semibold">Ø§Ù„Ø±Ø¤ÙŠØ© ÙˆØ§Ù„ØªØµÙˆØ±:</span>
                            <span class="text-white font-bold">Brahim BIDI</span>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <i class="fas fa-code text-blue-400"></i>
                            <span class="text-blue-200 font-semibold">Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„ØªÙ†ÙÙŠØ°:</span>
                            <span class="text-white font-bold">Claude (Anthropic)</span>
                        </div>
                    </div>
                    <div class="mt-3 text-sm text-gray-300">
                        <i class="fas fa-lightbulb text-yellow-400 mr-2"></i>
                        Ù†ØªØ§Ø¬ Ø¬Ù„Ø³Ø§Øª "Ø§Ù„ÙØ§ÙŠØ¨ÙŠÙ†Øº" Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© - ØªÙ„Ø§Ù‚ÙŠ Ø§Ù„Ø®ÙŠØ§Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ÙŠØ©
                    </div>
                    <div class="mt-2 text-xs text-gray-400">
                        CPF~ Lite v3.0-quantum | Ø¥Ø·Ø§Ø± Ø§Ù„Ù†Ù…Ø°Ø¬Ø© Ø§Ù„Ù…Ø¹Ø±ÙÙŠØ© Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function memoryReconstructionCPF() {
            return {
                // Available memories to choose from
                availableMemories: [
                    {
                        id: 'childhood_birthday',
                        title: 'Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø§Ù„Ø·ÙÙˆÙ„Ø© Ø§Ù„Ø«Ø§Ù…Ù†',
                        type: 'Ø§Ø­ØªÙØ§Ù„ÙŠØ© Ø¹Ø§Ø¦Ù„ÙŠØ©',
                        age: '15 Ø³Ù†Ø© Ù…Ø¶Øª',
                        importance: 'Ø¹Ø§Ù„ÙŠØ©',
                        originalContext: {
                            setting: 'Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø²Ù„',
                            people: ['Ø§Ù„Ø£Ù‡Ù„', 'Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡', 'Ø§Ù„Ø¬ÙŠØ±Ø§Ù†'],
                            activities: ['Ø§Ù„ÙƒÙŠÙƒ', 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨', 'Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§'],
                            weather: 'Ù…Ø´Ù…Ø³ ÙˆØ¯Ø§ÙØ¦',
                            emotions: { joy: 0.9, excitement: 0.8, gratitude: 0.7 }
                        },
                        baseNarrative: 'Ø§Ø­ØªÙØ§Ù„ Ø¬Ù…ÙŠÙ„ ÙÙŠ Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø²Ù„ Ù…Ø¹ Ø§Ù„Ø£Ù‡Ù„ ÙˆØ§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ ÙƒÙŠÙƒØ© Ø¨Ø§Ù„Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© ÙˆØ´Ù…ÙˆØ¹ Ù…Ù„ÙˆÙ†Ø©ØŒ Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ¶Ø­Ùƒ ÙˆÙ‡Ø¯Ø§ÙŠØ§ Ø±Ø§Ø¦Ø¹Ø©.'
                    },
                    {
                        id: 'first_job_day',
                        title: 'Ø£ÙˆÙ„ ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø¹Ù…Ù„',
                        type: 'Ø¥Ù†Ø¬Ø§Ø² Ù…Ù‡Ù†ÙŠ',
                        age: '5 Ø³Ù†ÙˆØ§Øª Ù…Ø¶Øª',
                        importance: 'Ù…ØªÙˆØ³Ø·Ø©',
                        originalContext: {
                            setting: 'Ù…ÙƒØªØ¨ ÙÙŠ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©',
                            people: ['Ø§Ù„Ø²Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯', 'Ø§Ù„Ù…Ø¯ÙŠØ±', 'Ø§Ù„Ù…Ø±Ø´Ø¯'],
                            activities: ['Ø§Ù„ØªÙˆØ¬ÙŠÙ‡', 'Ø§Ù„ØªØ¹Ø§Ø±Ù', 'Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£ÙˆÙ„Ù‰'],
                            weather: 'ØºØ§Ø¦Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹',
                            emotions: { anxiety: 0.6, excitement: 0.7, uncertainty: 0.8 }
                        },
                        baseNarrative: 'ØªÙˆØªØ± Ù…Ù…Ø²ÙˆØ¬ Ø¨Ø§Ù„Ø­Ù…Ø§Ø³ØŒ ÙˆØ¬ÙˆÙ‡ Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙ…Ù‡Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ù‚Ù‡ÙˆØ© Ø£ÙˆÙ„Ù‰ ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨ ÙˆØ´Ø¹ÙˆØ± Ø¨Ø§Ù„ÙØ®Ø± ÙˆØ§Ù„Ù‚Ù„Ù‚ Ù…Ø¹Ø§Ù‹.'
                    },
                    {
                        id: 'graduation_day',
                        title: 'ÙŠÙˆÙ… Ø§Ù„ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©',
                        type: 'Ø¥Ù†Ø¬Ø§Ø² Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ',
                        age: '3 Ø³Ù†ÙˆØ§Øª Ù…Ø¶Øª',
                        importance: 'Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹',
                        originalContext: {
                            setting: 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ù„Ø§Øª Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©',
                            people: ['Ø§Ù„Ø£Ù‡Ù„', 'Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡', 'Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©', 'Ø²Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©'],
                            activities: ['Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©', 'Ø§Ù„ØµÙˆØ± Ø§Ù„ØªØ°ÙƒØ§Ø±ÙŠØ©', 'Ø§Ù„Ø®Ø·Ø§Ø¨Ø§Øª'],
                            weather: 'Ù…Ø´Ù…Ø³ ÙˆÙ…Ø«Ø§Ù„ÙŠ',
                            emotions: { pride: 0.9, accomplishment: 0.9, nostalgia: 0.6, anxiety: 0.3 }
                        },
                        baseNarrative: 'Ù„Ø­Ø¸Ø© ÙØ®Ø± Ù„Ø§ ØªÙÙ†Ø³Ù‰ØŒ Ø±Ø¯Ø§Ø¡ Ø§Ù„ØªØ®Ø±Ø¬ Ø§Ù„Ø£Ø³ÙˆØ¯ØŒ ØµÙˆØª Ø§Ø³Ù…ÙŠ ÙŠÙÙ†Ø§Ø¯Ù‰ØŒ Ø¯Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø­ ÙÙŠ Ø¹ÙŠÙˆÙ† Ø§Ù„Ø£Ù‡Ù„ØŒ ÙˆØ´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².'
                    },
                    {
                        id: 'family_gathering',
                        title: 'ØªØ¬Ù…Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ø¹ÙŠØ¯',
                        type: 'Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
                        age: 'Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¶Øª',
                        importance: 'Ø¹Ø§Ù„ÙŠØ©',
                        originalContext: {
                            setting: 'Ø¨ÙŠØª Ø§Ù„Ø¬Ø¯Ø©',
                            people: ['Ø¬Ù…ÙŠØ¹ Ø£ÙØ±Ø§Ø¯ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©'],
                            activities: ['Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ', 'Ø§Ù„Ø­Ø¯ÙŠØ«', 'Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø£Ø·ÙØ§Ù„'],
                            weather: 'Ø¨Ø§Ø±Ø¯ ÙˆÙ„ÙƒÙ† Ø¯Ø§ÙØ¦ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨ÙŠØª',
                            emotions: { warmth: 0.8, belonging: 0.9, comfort: 0.8, melancholy: 0.3 }
                        },
                        baseNarrative: 'Ø¯ÙØ¡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŒ Ø±ÙˆØ§Ø¦Ø­ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØŒ Ø¶Ø­ÙƒØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„ØŒ Ø­ÙƒØ§ÙŠØ§Øª Ø§Ù„ÙƒØ¨Ø§Ø±ØŒ ÙˆØ´Ø¹ÙˆØ± Ø¹Ù…ÙŠÙ‚ Ø¨Ø§Ù„Ø§Ù†ØªÙ…Ø§Ø¡.'
                    }
                ],
                
                // Current state
                selectedMemoryId: 'childhood_birthday',
                selectedMemory: null,
                currentMood: {
                    joy: 0.5,
                    sadness: 0.2,
                    anxiety: 0.3,
                    nostalgia: 0.4
                },
                
                // Reconstruction results
                reconstructionMetrics: {
                    confidence: 0.7,
                    distortion: 0.3,
                    variation: 0.4
                },
                
                memoryVisualization: {
                    sceneStyle: '',
                    moodFilter: '',
                    elements: []
                },
                
                reconstructedNarrative: '',
                reconstructionWaves: [],
                
                // Comparison mode
                comparisonMode: false,
                reconstructionComparisons: [],
                
                // Analysis metrics
                originalMemoryTone: 'Ù…Ø­Ø§ÙŠØ¯ ÙˆÙ…ØªÙˆØ§Ø²Ù†',
                reconstructedMemoryTone: 'Ù…Ø­Ø§ÙŠØ¯ ÙˆÙ…ØªÙˆØ§Ø²Ù†',
                emotionalEncryption: {
                    strength: 0.5,
                    keyMatch: 0.7,
                    accessLevel: 'ÙƒØ§Ù…Ù„'
                },
                qualityMetrics: {
                    logicalConsistency: 0.8,
                    emotionalAuthenticity: 0.7
                },
                
                init() {
                    // Initialize with safe defaults
                    this.selectedMemory = this.availableMemories[0];
                    this.emotionalEncryption = {
                        strength: 0.5,
                        keyMatch: 0.7,
                        accessLevel: 'ÙƒØ§Ù…Ù„'
                    };
                    this.reconstructionMetrics = {
                        confidence: 0.7,
                        distortion: 0.3,
                        variation: 0.4
                    };
                    this.qualityMetrics = {
                        logicalConsistency: 0.8,
                        emotionalAuthenticity: 0.7
                    };
                    
                    this.loadMemory();
                    this.updateEmotionalFilter();
                    this.logToConsole('Ù†Ø¸Ø§Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª CPF~ Lite Ø¬Ø§Ù‡Ø²');
                },
                
                loadMemory() {
                    this.selectedMemory = this.availableMemories.find(m => m.id === this.selectedMemoryId);
                    this.reconstructMemory();
                },
                
                updateEmotionalFilter() {
                    // Calculate emotional filter metrics
                    const totalEmotion = Math.max(0.1, this.currentMood.joy + this.currentMood.sadness + 
                                       this.currentMood.anxiety + this.currentMood.nostalgia);
                    
                    // Normalize emotions to prevent division by zero
                    const normalizedMood = {
                        joy: this.currentMood.joy / totalEmotion,
                        sadness: this.currentMood.sadness / totalEmotion,
                        anxiety: this.currentMood.anxiety / totalEmotion,
                        nostalgia: this.currentMood.nostalgia / totalEmotion
                    };
                    
                    // Update encryption metrics with safe calculations
                    this.emotionalEncryption.strength = Math.max(0.1, Math.min(0.95, 
                        Math.max(this.currentMood.sadness, this.currentMood.anxiety)));
                    this.emotionalEncryption.keyMatch = this.calculateEmotionalKeyMatch();
                    this.emotionalEncryption.accessLevel = this.getAccessLevel();
                    
                    // Update reconstruction if memory is loaded
                    if (this.selectedMemory) {
                        this.reconstructMemory();
                    }
                },
                
                async reconstructMemory() {
                    if (!this.selectedMemory) return;
                    
                    this.logToConsole('ğŸ§  Ø¨Ø¯Ø¡ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø°ÙƒØ±Ù‰ Ø¨Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©...');
                    
                    // Create reconstruction waves
                    this.createReconstructionWaves();
                    
                    // Calculate reconstruction with WebPPL-like logic
                    const reconstruction = await this.calculateReconstructionWithWebPPL();
                    
                    // Update visualization
                    this.updateMemoryVisualization(reconstruction);
                    
                    // Update narrative
                    this.reconstructedNarrative = reconstruction.narrative;
                    
                    // Update metrics
                    this.reconstructionMetrics = reconstruction.metrics;
                    this.originalMemoryTone = this.getOriginalTone();
                    this.reconstructedMemoryTone = reconstruction.tone;
                    this.qualityMetrics = reconstruction.quality;
                    
                    this.logToConsole(`âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„Ø«Ù‚Ø©: ${(reconstruction.metrics.confidence * 100).toFixed(1)}%`);
                },
                
                async calculateReconstructionWithWebPPL() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            const memory = this.selectedMemory;
                            const mood = this.currentMood;
                            
                            // Emotional filter calculation (WebPPL-like)
                            const emotionalFilter = this.calculateEmotionalFilter(mood);
                            const contextualBias = this.calculateContextualBias();
                            const reconstructionNoise = Math.random() * 0.3;
                            
                            // Narrative reconstruction based on dominant emotion
                            const dominantEmotion = this.getDominantEmotion();
                            const narrative = this.reconstructNarrative(memory, dominantEmotion, emotionalFilter);
                            
                            // Calculate metrics with safe bounds
                            const confidence = Math.max(0.1, Math.min(0.95, this.calculateReconstructionConfidence(emotionalFilter, mood)));
                            const distortion = Math.max(0.05, Math.min(0.95, this.calculateEmotionalDistortion(memory, mood)));
                            const variation = Math.max(0.1, Math.min(0.9, Math.random() * 0.6 + 0.2));
                            
                            // Calculate quality metrics with validation
                            const logicalConsistency = Math.max(0.1, Math.min(0.95, 1 - distortion * 0.7));
                            const emotionalAuthenticity = Math.max(0.1, Math.min(0.95, confidence * 0.9 + Math.random() * 0.1));
                            
                            const result = {
                                narrative: narrative,
                                tone: this.calculateReconstructedTone(dominantEmotion),
                                metrics: {
                                    confidence: confidence,
                                    distortion: distortion,
                                    variation: variation
                                },
                                quality: {
                                    logicalConsistency: logicalConsistency,
                                    emotionalAuthenticity: emotionalAuthenticity
                                },
                                emotionalFilter: emotionalFilter,
                                dominantEmotion: dominantEmotion
                            };
                            
                            resolve(result);
                        }, 500);
                    });
                },
                
                calculateEmotionalFilter(mood) {
                    const joyWeight = mood.joy || 0;
                    const sadnessWeight = mood.sadness || 0;
                    const anxietyWeight = mood.anxiety || 0;
                    const nostalgiaWeight = mood.nostalgia || 0;
                    
                    const positiveEmotions = joyWeight + nostalgiaWeight;
                    const negativeEmotions = sadnessWeight + anxietyWeight;
                    const valenceBias = positiveEmotions - negativeEmotions;
                    const maxEmotion = Math.max(sadnessWeight, anxietyWeight, joyWeight);
                    
                    return {
                        valenceBias: Math.max(-1, Math.min(1, valenceBias)), // Bound between -1 and 1
                        intensityMultiplier: Math.max(0.5, Math.min(2.0, 1 + maxEmotion * 0.5)),
                        distortionLevel: Math.max(0.05, Math.min(0.95, Math.max(sadnessWeight, anxietyWeight) * 0.8)),
                        nostalgicBlur: Math.max(0, Math.min(1, nostalgiaWeight * 0.6))
                    };
                },
                
                reconstructNarrative(memory, dominantEmotion, filter) {
                    const baseNarrative = memory.baseNarrative;
                    
                    switch(dominantEmotion) {
                        case 'joy':
                            return this.applyJoyfulReconstruction(baseNarrative, filter);
                        case 'sadness':
                            return this.applySadReconstruction(baseNarrative, filter);
                        case 'anxiety':
                            return this.applyAnxiousReconstruction(baseNarrative, filter);
                        case 'nostalgia':
                            return this.applyNostalgicReconstruction(baseNarrative, filter);
                        default:
                            return baseNarrative;
                    }
                },
                
                applyJoyfulReconstruction(base, filter) {
                    const joyfulElements = [
                        'ÙƒØ§Ù† ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ´Ø¹ Ø¨Ø§Ù„ÙØ±Ø­ ÙˆØ§Ù„Ø¨Ù‡Ø¬Ø©',
                        'Ø§Ø¨ØªØ³Ø§Ù…Ø§Øª Ø¯Ø§ÙØ¦Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ù…ÙƒØ§Ù†',
                        'Ø´Ø¹ÙˆØ± Ø±Ø§Ø¦Ø¹ Ø¨Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ÙˆØ§Ù„Ø§Ù…ØªÙ†Ø§Ù†',
                        'Ù„Ø­Ø¸Ø§Øª Ù…Ø¶ÙŠØ¦Ø© Ù„Ø§ ØªÙÙ†Ø³Ù‰',
                        'Ø¬Ùˆ Ù…ÙØ¹Ù… Ø¨Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©'
                    ];
                    
                    const selectedElements = joyfulElements.slice(0, Math.floor(Math.random() * 3) + 1);
                    return base + ' ' + selectedElements.join('ØŒ ') + '.';
                },
                
                applySadReconstruction(base, filter) {
                    const sadElements = [
                        'Ø±ØºÙ… Ø§Ù„Ø¬Ùˆ Ø§Ù„Ø¬Ù…ÙŠÙ„ØŒ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø´Ø¹ÙˆØ± Ø®ÙÙŠ Ø¨Ø§Ù„ÙˆØ­Ø¯Ø©',
                        'Ø§Ø¨ØªØ³Ø§Ù…Ø§Øª Ù…ØµØ·Ù†Ø¹Ø© ØªØ®ÙÙŠ Ø­Ø²Ù†Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹',
                        'Ø´Ø¹ÙˆØ± Ø¨Ø£Ù† Ø´ÙŠØ¦Ø§Ù‹ Ù…Ø§ ÙƒØ§Ù† Ù…ÙÙ‚ÙˆØ¯Ø§Ù‹',
                        'Ù„Ø­Ø¸Ø§Øª Ø¬Ù…ÙŠÙ„Ø© ÙˆÙ„ÙƒÙ† Ø¹Ø§Ø¨Ø±Ø©',
                        'Ø­Ù†ÙŠÙ† Ù…Ø¤Ù„Ù… Ù„Ø£ÙˆÙ‚Ø§Øª Ø£Ø¨Ø³Ø·'
                    ];
                    
                    const selectedElements = sadElements.slice(0, Math.floor(Math.random() * 3) + 1);
                    return base.replace(/Ø¬Ù…ÙŠÙ„|Ø±Ø§Ø¦Ø¹|Ù…Ø°Ù‡Ù„/g, 'Ø­Ø²ÙŠÙ† Ù†ÙˆØ¹Ø§Ù‹ Ù…Ø§') + ' ' + selectedElements.join('ØŒ ') + '.';
                },
                
                applyAnxiousReconstruction(base, filter) {
                    const anxiousElements = [
                        'Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„ØªÙˆØªØ± ÙˆØ§Ù„Ù‚Ù„Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„',
                        'Ø®ÙˆÙ Ø®ÙÙŠ Ù…Ù† Ø¹Ø¯Ù… ØªÙ„Ø¨ÙŠØ© Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª',
                        'Ù‚Ù„Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ù…ÙˆØ± Ù‚Ø¯ ØªØ³ÙˆØ¡',
                        'ØªÙˆØªØ± Ù…Ù† ÙƒØ«Ø±Ø© Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ²',
                        'Ø´ÙƒÙˆÙƒ Ø­ÙˆÙ„ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ù„Ù‰ Ù…Ø§ ÙŠØ±Ø§Ù…'
                    ];
                    
                    const selectedElements = anxiousElements.slice(0, Math.floor(Math.random() * 2) + 1);
                    return base.replace(/Ù…Ø±ÙŠØ­|Ù‡Ø§Ø¯Ø¦/g, 'Ù…Ù‚Ù„Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹') + ' Ù…Ø¹ ' + selectedElements.join(' Ùˆ') + '.';
                },
                
                applyNostalgicReconstruction(base, filter) {
                    const nostalgicElements = [
                        'Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø±Ø§Ø¡Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© Ø§Ù„ØªÙŠ Ù„Ù† ØªØ¹ÙˆØ¯',
                        'Ø°ÙƒØ±ÙŠØ§Øª Ø°Ù‡Ø¨ÙŠØ© Ù…Ù† Ø²Ù…Ù† Ø£Ø¨Ø³Ø· ÙˆØ£Ù†Ù‚Ù‰',
                        'Ø´Ø¹ÙˆØ± Ø¯Ø§ÙØ¦ Ø¨Ø§Ù„Ø­Ù†ÙŠÙ† Ù„ØªÙ„Ùƒ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª',
                        'Ù„Ø­Ø¸Ø§Øª Ø³Ø­Ø±ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø§Ø¶ÙŠ Ø§Ù„Ø¹Ø°Ø¨',
                        'Ø²Ù…Ù† Ø¬Ù…ÙŠÙ„ Ù…Ø¶Ù‰ ÙˆØªØ±Ùƒ Ø£Ø«Ø±Ø§Ù‹ Ø¹Ù…ÙŠÙ‚Ø§Ù‹'
                    ];
                    
                    const selectedElements = nostalgicElements.slice(0, Math.floor(Math.random() * 2) + 1);
                    return 'ÙÙŠ ' + base + ' ÙƒØ§Ù†Øª ØªÙ„Ùƒ ' + selectedElements.join('ØŒ ') + '.';
                },
                
                updateMemoryVisualization(reconstruction) {
                    const mood = this.currentMood;
                    const dominantEmotion = reconstruction.dominantEmotion;
                    
                    // Update scene style based on mood
                    this.memoryVisualization.sceneStyle = this.calculateSceneStyle(dominantEmotion, mood);
                    this.memoryVisualization.moodFilter = this.calculateMoodFilter(dominantEmotion, mood);
                    
                    // Update elements
                    this.memoryVisualization.elements = this.generateMemoryElements(reconstruction);
                },
                
                calculateSceneStyle(dominantEmotion, mood) {
                    const emotionStyles = {
                        joy: 'background: linear-gradient(135deg, #FFD700, #FFA500, #FF6347); filter: brightness(1.2) saturate(1.3);',
                        sadness: 'background: linear-gradient(135deg, #4682B4, #2F4F4F, #708090); filter: brightness(0.7) saturate(0.8);',
                        anxiety: 'background: linear-gradient(135deg, #DC143C, #B22222, #8B0000); filter: contrast(1.2) saturate(1.1);',
                        nostalgia: 'background: linear-gradient(135deg, #DDA0DD, #D8BFD8, #E6E6FA); filter: sepia(0.3) blur(1px);'
                    };
                    
                    return emotionStyles[dominantEmotion] || emotionStyles.nostalgia;
                },
                
                calculateMoodFilter(dominantEmotion, mood) {
                    const filterStyles = {
                        joy: 'background: radial-gradient(circle, rgba(255,215,0,0.2) 0%, rgba(255,165,0,0.1) 50%, transparent 100%);',
                        sadness: 'background: linear-gradient(0deg, rgba(70,130,180,0.3) 0%, rgba(47,79,79,0.2) 100%);',
                        anxiety: 'background: radial-gradient(ellipse, rgba(220,20,60,0.2) 0%, transparent 70%);',
                        nostalgia: 'background: linear-gradient(45deg, rgba(221,160,221,0.2) 0%, rgba(230,230,250,0.1) 100%);'
                    };
                    
                    return filterStyles[dominantEmotion] || filterStyles.nostalgia;
                },
                
                generateMemoryElements(reconstruction) {
                    const elements = [];
                    const memory = this.selectedMemory;
                    const dominantEmotion = reconstruction.dominantEmotion;
                    
                    // Generate different elements based on memory type
                    if (memory.id === 'childhood_birthday') {
                        elements.push(
                            {
                                id: 'cake',
                                content: 'ğŸ‚',
                                style: `top: 40%; left: 45%; font-size: 4rem; transform: scale(${reconstruction.metrics.confidence});`,
                                classes: dominantEmotion === 'joy' ? 'detail-highlight' : dominantEmotion === 'sadness' ? 'glitch' : '',
                                particles: this.generateEmotionParticles(dominantEmotion, 3)
                            },
                            {
                                id: 'balloons',
                                content: 'ğŸˆğŸˆğŸˆ',
                                style: `top: 20%; left: 20%; font-size: 2rem;`,
                                classes: 'fade-memory',
                                particles: this.generateEmotionParticles(dominantEmotion, 2)
                            },
                            {
                                id: 'family',
                                content: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
                                style: `top: 60%; left: 25%; font-size: 3rem;`,
                                classes: dominantEmotion === 'nostalgia' ? 'detail-highlight' : '',
                                particles: this.generateEmotionParticles(dominantEmotion, 4)
                            }
                        );
                    } else if (memory.id === 'graduation_day') {
                        elements.push(
                            {
                                id: 'diploma',
                                content: 'ğŸ“',
                                style: `top: 35%; left: 50%; font-size: 4rem;`,
                                classes: dominantEmotion === 'joy' ? 'detail-highlight' : '',
                                particles: this.generateEmotionParticles(dominantEmotion, 5)
                            },
                            {
                                id: 'crowd',
                                content: 'ğŸ‘¥ğŸ‘¥ğŸ‘¥',
                                style: `top: 70%; left: 30%; font-size: 2rem;`,
                                classes: dominantEmotion === 'anxiety' ? 'glitch' : '',
                                particles: this.generateEmotionParticles(dominantEmotion, 3)
                            }
                        );
                    }
                    
                    return elements;
                },
                
                generateEmotionParticles(emotion, count) {
                    const particles = [];
                    const colors = {
                        joy: '#FFD700',
                        sadness: '#4682B4',
                        anxiety: '#DC143C',
                        nostalgia: '#DDA0DD'
                    };
                    
                    for (let i = 0; i < count; i++) {
                        particles.push({
                            id: Math.random().toString(36),
                            style: `
                                left: ${Math.random() * 60 + 20}%; 
                                top: ${Math.random() * 60 + 20}%; 
                                background: ${colors[emotion]}; 
                                animation-delay: ${Math.random() * 2}s;
                            `
                        });
                    }
                    
                    return particles;
                },
                
                createReconstructionWaves() {
                    this.reconstructionWaves = [];
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            this.reconstructionWaves.push({
                                id: Math.random().toString(36),
                                style: `
                                    left: ${Math.random() * 80 + 10}%; 
                                    top: ${Math.random() * 80 + 10}%; 
                                    width: 20px; height: 20px;
                                    border-color: rgba(255,255,255,0.6);
                                    animation-delay: ${i * 0.3}s;
                                `
                            });
                        }, i * 300);
                    }
                    
                    // Clear waves after animation
                    setTimeout(() => {
                        this.reconstructionWaves = [];
                    }, 3000);
                },
                
                async compareReconstructions() {
                    this.logToConsole('ğŸ” Ø¨Ø¯Ø¡ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¥Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©...');
                    
                    const moodVariations = [
                        { label: 'Ø³Ø¹ÙŠØ¯ Ø¬Ø¯Ø§Ù‹', mood: { joy: 0.9, sadness: 0.0, anxiety: 0.1, nostalgia: 0.0 } },
                        { label: 'Ø­Ø²ÙŠÙ† ÙˆÙ…ÙƒØªØ¦Ø¨', mood: { joy: 0.0, sadness: 0.9, anxiety: 0.1, nostalgia: 0.0 } },
                        { label: 'Ø­Ù†ÙŠÙ† Ù„Ù„Ù…Ø§Ø¶ÙŠ', mood: { joy: 0.2, sadness: 0.1, anxiety: 0.0, nostalgia: 0.9 } }
                    ];
                    
                    this.reconstructionComparisons = [];
                    
                    for (const variation of moodVariations) {
                        // Temporarily change mood for reconstruction
                        const originalMood = { ...this.currentMood };
                        this.currentMood = variation.mood;
                        
                        const reconstruction = await this.calculateReconstructionWithWebPPL();
                        
                        this.reconstructionComparisons.push({
                            moodLabel: variation.label,
                            dominantEmotion: this.getDominantEmotionIcon(reconstruction.dominantEmotion),
                            miniScene: this.calculateSceneStyle(reconstruction.dominantEmotion, variation.mood),
                            moodFilter: this.calculateMoodFilter(reconstruction.dominantEmotion, variation.mood),
                            focus: this.getReconstructionFocus(reconstruction.dominantEmotion),
                            tone: reconstruction.tone,
                            details: this.getDetailLevel(reconstruction.dominantEmotion),
                            confidence: reconstruction.metrics.confidence,
                            distortion: reconstruction.metrics.distortion
                        });
                        
                        // Restore original mood
                        this.currentMood = originalMood;
                    }
                    
                    this.comparisonMode = true;
                    this.logToConsole('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¥Ø¹Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡');
                },
                
                randomizeMood() {
                    this.currentMood = {
                        joy: Math.random(),
                        sadness: Math.random(),
                        anxiety: Math.random(),
                        nostalgia: Math.random()
                    };
                    this.updateEmotionalFilter();
                    this.logToConsole('ğŸ² ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù…Ø²Ø§Ø¬ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯');
                },
                
                // Utility methods
                getDominantEmotion() {
                    const mood = this.currentMood;
                    const emotions = [
                        { name: 'joy', value: mood.joy },
                        { name: 'sadness', value: mood.sadness },
                        { name: 'anxiety', value: mood.anxiety },
                        { name: 'nostalgia', value: mood.nostalgia }
                    ];
                    
                    return emotions.reduce((prev, current) => 
                        current.value > prev.value ? current : prev
                    ).name;
                },
                
                getDominantEmotionIcon(emotion) {
                    const icons = {
                        joy: 'ğŸ˜Š',
                        sadness: 'ğŸ˜¢',
                        anxiety: 'ğŸ˜°',
                        nostalgia: 'ğŸŒ…'
                    };
                    return icons[emotion] || 'ğŸ˜';
                },
                
                calculateEmotionalKeyMatch() {
                    if (!this.selectedMemory || !this.selectedMemory.originalContext || !this.selectedMemory.originalContext.emotions) {
                        return 0.5; // Default neutral match
                    }
                    
                    const originalEmotions = this.selectedMemory.originalContext.emotions;
                    const currentMood = this.currentMood;
                    
                    // Calculate similarity between original and current emotions
                    let similarity = 0;
                    let count = 0;
                    
                    // Map common emotions
                    const emotionMap = {
                        'joy': 'joy',
                        'sadness': 'sadness', 
                        'anxiety': 'anxiety',
                        'nostalgia': 'nostalgia',
                        'excitement': 'joy', // Map excitement to joy
                        'pride': 'joy', // Map pride to joy
                        'accomplishment': 'joy', // Map accomplishment to joy
                        'uncertainty': 'anxiety' // Map uncertainty to anxiety
                    };
                    
                    Object.keys(originalEmotions).forEach(originalEmotion => {
                        const mappedEmotion = emotionMap[originalEmotion];
                        if (mappedEmotion && currentMood[mappedEmotion] !== undefined) {
                            const originalValue = originalEmotions[originalEmotion] || 0;
                            const currentValue = currentMood[mappedEmotion] || 0;
                            similarity += 1 - Math.abs(originalValue - currentValue);
                            count++;
                        }
                    });
                    
                    return count > 0 ? Math.max(0.1, Math.min(0.95, similarity / count)) : 0.5;
                },
                
                getAccessLevel() {
                    const keyMatch = this.emotionalEncryption.keyMatch;
                    if (keyMatch > 0.7) return 'ÙƒØ§Ù…Ù„';
                    if (keyMatch > 0.4) return 'Ø¬Ø²Ø¦ÙŠ';
                    return 'Ù…Ø­Ø¯ÙˆØ¯';
                },
                
                calculateReconstructionConfidence(filter, mood) {
                    const keyMatch = this.emotionalEncryption.keyMatch || 0.5;
                    const valenceBias = filter.valenceBias || 0;
                    const stability = 1 - Math.abs(valenceBias);
                    const baseConfidence = (keyMatch * 0.6 + stability * 0.4);
                    const randomVariation = 0.7 + Math.random() * 0.3;
                    return Math.max(0.1, Math.min(0.95, baseConfidence * randomVariation));
                },
                
                calculateEmotionalDistortion(memory, mood) {
                    if (!memory || !memory.originalContext || !memory.originalContext.emotions) {
                        return 0.3 + Math.random() * 0.2; // Default fallback
                    }
                    
                    const originalValence = this.getOriginalValence(memory);
                    const currentValence = ((mood.joy || 0) + (mood.nostalgia || 0)) - ((mood.sadness || 0) + (mood.anxiety || 0));
                    const valenceDiff = Math.abs(originalValence - currentValence);
                    return Math.max(0.05, Math.min(0.95, valenceDiff * 0.3 + Math.random() * 0.2));
                },
                
                getOriginalValence(memory) {
                    if (!memory || !memory.originalContext || !memory.originalContext.emotions) {
                        return 0; // Default neutral valence
                    }
                    
                    const emotions = memory.originalContext.emotions;
                    const positive = (emotions.joy || 0) + (emotions.excitement || 0) + (emotions.pride || 0) + (emotions.accomplishment || 0);
                    const negative = (emotions.anxiety || 0) + (emotions.sadness || 0) + (emotions.uncertainty || 0);
                    return Math.max(-1, Math.min(1, positive - negative)); // Bound between -1 and 1
                },
                
                getOriginalTone() {
                    if (!this.selectedMemory) return 'Ù…Ø­Ø§ÙŠØ¯';
                    const emotions = this.selectedMemory.originalContext.emotions;
                    const positive = (emotions.joy || 0) + (emotions.excitement || 0) + (emotions.pride || 0);
                    const negative = (emotions.anxiety || 0);
                    
                    if (positive > negative * 2) return 'Ø¥ÙŠØ¬Ø§Ø¨ÙŠ ÙˆÙ…Ø´Ø±Ù‚';
                    if (negative > positive) return 'Ù…Ù‚Ù„Ù‚ ÙˆÙ…ØªÙˆØªØ±';
                    return 'Ù…ØªÙˆØ§Ø²Ù† ÙˆÙ…Ø­Ø§ÙŠØ¯';
                },
                
                calculateReconstructedTone(dominantEmotion) {
                    const tones = {
                        joy: 'Ù…ÙØ¹Ù… Ø¨Ø§Ù„ÙØ±Ø­ ÙˆØ§Ù„Ø¨Ù‡Ø¬Ø©',
                        sadness: 'Ø­Ø²ÙŠÙ† ÙˆÙ…Ø¤Ø«Ø±',
                        anxiety: 'Ù…Ù‚Ù„Ù‚ ÙˆÙ…ØªÙˆØªØ±',
                        nostalgia: 'Ø­Ù†ÙŠÙ†ÙŠ ÙˆØ¯Ø§ÙØ¦'
                    };
                    return tones[dominantEmotion] || 'Ù…Ø­Ø§ÙŠØ¯';
                },
                
                calculateContextualBias() {
                    return {
                        similarity: 0.6 + Math.random() * 0.3,
                        relevance: 0.7 + Math.random() * 0.2
                    };
                },
                
                getReconstructionFocus(emotion) {
                    const focuses = {
                        joy: 'Ø§Ù„Ù„Ø­Ø¸Ø§Øª Ø§Ù„Ø³Ø¹ÙŠØ¯Ø© ÙˆØ§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©',
                        sadness: 'Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ù…Ø¤Ù„Ù…Ø© ÙˆØ§Ù„ÙÙ‚Ø¯Ø§Ù†',
                        anxiety: 'Ø§Ù„Ù…Ø®Ø§ÙˆÙ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª',
                        nostalgia: 'Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙˆØ§Ù„Ø­Ù†ÙŠÙ†'
                    };
                    return focuses[emotion] || 'Ù…ØªÙˆØ§Ø²Ù†';
                },
                
                getDetailLevel(emotion) {
                    const levels = {
                        joy: 'ØªÙØ§ØµÙŠÙ„ Ù…Ø´Ø±Ù‚Ø© ÙˆÙ…ÙƒØ«ÙØ©',
                        sadness: 'ØªÙØ§ØµÙŠÙ„ Ø¨Ø§Ù‡ØªØ© ÙˆÙ…Ø¨Ù‡Ù…Ø©',
                        anxiety: 'ØªÙØ§ØµÙŠÙ„ Ù…ØªÙ‚Ø·Ø¹Ø© ÙˆÙ…Ø´ÙˆØ´Ø©',
                        nostalgia: 'ØªÙØ§ØµÙŠÙ„ Ø¯Ø§ÙØ¦Ø© ÙˆÙ…Ø«Ø§Ù„ÙŠØ©'
                    };
                    return levels[emotion] || 'ØªÙØ§ØµÙŠÙ„ Ø¹Ø§Ø¯ÙŠØ©';
                },
                
                logToConsole(message) {
                    const console = document.getElementById('webpplConsole');
                    const timestamp = new Date().toLocaleTimeString('ar-SA');
                    console.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                    console.scrollTop = console.scrollHeight;
                }
            }
        }
    </script>
</body>
</html>